Alert Handler
==

IOT-Tree内置了很强大的报警支持，可以让你非常快速的针对一些数据指标产生对应的报警信息和运行过程中产生报警之后的处理过程。

理论上，你可以通过任务(Task)内部的JS脚本，不断的对关注的数据标签(Tags)实时数据进行读取分析和判断，并根据自己的需要产生特定的报警。但这样做肯定会让你厌烦。

事实上，一个自动化监控现场，报警的产生有很大的规律性，并且对于产生的报警后续如何处理也有一定的套路。因此，IOT-Tree也对此作了专门的实现。

## 1 IOT-Tree报警实现机制

为了极大方便你的使用，IOT-Tree把报警管理分成三部分：

<img src="../img/main/m024.png" />

>1 定义报警源：此部分直接在Tag定义中实现，你只需要在关注的数据标签Tag中定义可能的报警条件和提示即可。此部分你不需要考虑任何报警的后续处理。

>2 定义报警处理（Handler）：基于标签数据Tags产生的报警源信息，你可以对这些报警源进行分组、分级。如果某个Tag中的报警源归入某个处理,则此报警源就可以起作用了。

>3 定义报警输出：定义特定的报警数据输出项，然后关联报警处理(Handler)，则相关的报警源产生的报警数据就会推送到输出项中。

<font color=red>请注意：如果你仅仅在标签中定义了报警源而没有定义报警处理，那么你这个项目将不会产生报警数据。你唯一能看到的报警信息只有在管理界面中的标签列表中。</font>

在定义了报警处理之后，系统内部定义的HMI(UI)画面中，在运行时会有报警数据产生，并且能够显示到通用的报警列表中。如下图：

<img src="../img/main/m025.png" />

<font color=green>在很多场合，你需要在某个关键的报警信息产生时，通过特殊的方式提醒相关人员，那么你就需要定义报警输出了。比如，你可以定义一个支持手机短信的报警输出，或者你可以定义某个特殊的报警输出，使得IOT-Tree能够输出某个开关信号到现场声光提醒设备中。</font>

接下来，我们会详细说明IOT-Tree的报警管理是如何支持的。为了方便，我们还是以IOT-Tree内部自带的Demo项目"Water tank and Medicament dosing"进行说明。

## 2 在Tag中定义报警源

在IOT-Tree中的标签编辑对话框中，你可以直接添加多个报警数据源。我们双击项目中容器节点"/watertank/ch1/aio"下的标签"wl_val"，在弹出的对话框中可以看到此标签定义了3个报警数据源。 如下图：
<img src="../img/main/m026.png" />

如果你要新增一个报警数据源，则点击Alert项右边的"Add Alert Source"按钮；或者你要编辑现有的某个报警数据源，则鼠标点击对应的报警源即可。弹出的报警源编辑界面如下：

<img src="../img/main/m027.png" />

### 2.1 报警源支持的Tag数据类型

### 2.2 报警源类型

#### 2.2.1 

在IOT-Tree中的容器节点中，你可以定义普通标签(Tag)和中间标签（Middle Tag），其中，中间标准通过JS表单式的方式定义，可以很灵活的利用其它标签数据进行组合。那么，仅仅通过标签，你就可以很灵活的产生项目实际需要的报警源了。例如：你希望根据多个设备数据的多种条件产生某个报警数据，则你只需要定义一个中间标签(Middle Tag),这个中间标签返回bool数据，内部使用对应设备数据的其他Tag即可。

## 3 定义报警处理

## 4 报警在监控UI中的展示

## 5 例子说明

## 6 总结
